<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Bacs Direct Debit Setup (Checkout)</title>
    <script src="https://js.stripe.com/v3/"></script>
  </head>
  <body>
    <h1>Set up your Direct Debit</h1>

    <form id="setup-form">
      <label>
        Name
        <input id="name" type="text" required />
      </label>
      <br /><br />
      <label>
        Email
        <input id="email" type="email" required />
      </label>
      <br /><br />
      <button type="submit">Authorize Direct Debit</button>
    </form>

    <script>
      const form = document.getElementById("setup-form");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;

        // Call backend to create Checkout session
        const res = await fetch("/create-checkout-session", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email }),
        });

        const { url } = await res.json();

        // Redirect to Stripe Checkout
        window.location.href = url;
      });
    </script>
  </body>
</html>